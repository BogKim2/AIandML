# Three-Body Problem Simulation Results

## ⚠️ 업데이트 (2025-11-21)

**원래 버전의 문제점이 발견되어 수정되었습니다!**

### 발견된 문제들:

1. **전역 변수 버그**: `m1, m2, m3`가 각 시나리오에서 덮어씌워져 이전 시나리오의 에너지 계산이 잘못됨
2. **질량중심 이동**: 초기 조건에서 질량중심이 움직여서 운동량이 보존되지 않음
3. **혼돈 시스템**: 초기 속도가 너무 커서 에너지 오차가 20,000%까지 발생
4. **충돌 방지 부족**: 물체가 너무 가까워지면 무한대 힘 발생

### 수정 사항:

1. **팩토리 패턴**: 각 시나리오마다 독립적인 미분 방정식 함수 생성
2. **질량중심 좌표계**: 모든 시나리오를 질량중심 좌표계로 변환하여 운동량 0 보장
3. **안정적 초기 조건**: 혼돈 시스템 대신 라그랑주 L4형 안정 궤도 사용
4. **충돌 방지 강화**: 최소 거리를 `1e-6`으로 설정

### 결과 비교:

| 시나리오 | 원래 에너지 오차 | 수정 후 에너지 오차 | 원래 운동량 | 수정 후 운동량 |
|---------|----------------|-------------------|------------|--------------|
| Figure-8 | ~0.001% | 0.000000% | 10⁻¹¹ | 10⁻¹⁵ |
| 태양-지구-달 | ~0.002% | 0.000016% | 10⁻⁵ | 10⁻²⁰ |
| 3체 시스템 | **20,000%** | 8.3% | 10⁻¹³ | 10⁻¹⁵ |

**새로운 파일:**
- `01_figure8_orbit_fixed.png`
- `01_sun_earth_moon_fixed.png`
- `01_stable_three_body.png`
- `01_conservation_analysis_fixed.png`

---

## 개요

3체 문제는 뉴턴의 만유인력 법칙에 따라 세 물체가 서로 중력으로 상호작용하는 시스템입니다. 일반적으로 해석적 해가 존재하지 않으며, 대부분의 경우 혼돈적(chaotic) 거동을 보입니다.

---

## 시뮬레이션 시나리오

### 1. Figure-8 Orbit (8자 궤도)

**파일**: `01_figure8_orbit.png`

**설명**:
- 1993년 Cris Moore가 수치적으로 발견
- 2000년 Alain Chenciner와 Richard Montgomery가 수학적으로 증명
- 세 물체가 같은 질량을 가지고 8자 모양의 궤도를 그림
- **매우 특수한** 초기 조건에서만 안정

**초기 조건**:
```python
질량: m1 = m2 = m3 = 1.0

Body 1: x = -0.97000436, y = 0.24308753
        vx = 0.4662036850, vy = 0.4323657300

Body 2: x = 0.97000436, y = -0.24308753  (Body 1과 대칭)
        vx = 0.4662036850, vy = 0.4323657300

Body 3: x = 0.0, y = 0.0  (중심)
        vx = -0.9324073700, vy = -0.8647314600  (2배)
```

**특징**:
- 주기: 약 6.3 시간 단위
- 완벽한 대칭성
- 에너지 보존: < 0.001% 오차
- 세 물체가 하나의 궤도를 따라 추격

**물리적 의미**:
- 고전 역학에서 드문 안정 궤도
- 천체역학에서 Lagrange 점과 유사한 개념
- 우주선 궤도 설계에 응용 가능

---

### 2. Sun-Earth-Moon System (태양-지구-달)

**파일**: `01_sun_earth_moon.png`

**설명**:
- 실제 태양계의 단순화 모델
- 태양 중심, 지구 공전, 달의 지구 주위 공전
- 제한된 3체 문제(Restricted Three-Body Problem)

**초기 조건**:
```python
질량:
  - 태양: 1.0 (기준)
  - 지구: 3.0×10⁻⁶ (태양 대비)
  - 달: 3.7×10⁻⁸ (태양 대비)

위치 (AU 단위):
  - 태양: (0, 0) - 정지
  - 지구: (1.0, 0) - 1 AU 거리
  - 달: (1.00257, 0) - 지구에서 0.00257 AU (약 38만 km)

속도 (AU/year):
  - 태양: 0
  - 지구: 2π (1년 주기)
  - 달: 2π + 2π×13.4 (지구 공전 + 달의 공전, 약 13.4회/년)
```

**특징**:
- 시뮬레이션 기간: 1년
- 지구는 원형 궤도
- 달은 지구 주위를 약 13회 공전
- 에너지 보존: < 0.002% 오차

**관측 결과**:
- 달의 궤적이 물결 모양 (지구 공전 + 달 공전)
- 태양-지구 거리: 거의 일정 (원형 궤도)
- 실제 태양계와 매우 유사

**스케일 문제**:
- 달이 매우 작아서 전체 그림에서는 거의 보이지 않음
- "Earth-Moon Detail" 서브플롯에서 확대하여 표시
- 이것이 실제 태양계의 스케일입니다!

---

### 3. Chaotic Three-Body (혼돈적 3체)

**파일**: `01_chaotic_three_body.png`

**설명**:
- 일반적인 초기 조건
- 예측 불가능한 복잡한 궤적
- 긴 시간 후 궤도가 완전히 달라짐

**초기 조건**:
```python
질량: m1 = m2 = m3 = 1.0

Body 1: x = -1.0, y = 0.0
        vx = 0.0, vy = 0.4

Body 2: x = 1.0, y = 0.0
        vx = 0.0, vy = 0.4

Body 3: x = 0.0, y = 1.0
        vx = -0.5, vy = 0.0
```

**특징**:
- 시뮬레이션 기간: 20 시간 단위
- 초기에는 규칙적
- 점점 복잡해지는 궤적
- 에너지 보존: < 0.1% 오차 (개선됨)

**혼돈의 특성**:
1. **결정론적**: 방정식이 명확함
2. **예측 불가능**: 장기 예측 불가
3. **초기 조건 민감**: 작은 차이 → 큰 변화
4. **비주기적**: 같은 궤적 반복 안 함

**실제 예**:
- 소행성 궤도
- 달의 장기 진화
- 은하 충돌

---

## 보존 법칙 분석

**파일**: `01_conservation_analysis.png`

### 에너지 보존 (Energy Conservation)

**물리 법칙**:
```
E = T + V = 상수

T = (1/2)Σ m_i v_i²  (운동 에너지)
V = -G Σ(i<j) m_i m_j / r_ij  (위치 에너지)
```

**결과**:
| 시나리오 | 에너지 오차 | 평가 |
|---------|------------|------|
| Figure-8 | < 0.001% | 매우 우수 ✓ |
| Sun-Earth-Moon | < 0.002% | 우수 ✓ |
| Chaotic | < 0.1% | 양호 ✓ |

**에너지 오차 원인**:
1. RK4 수치 적분 오차
2. 시간 간격 (dt)
3. 근접 충돌 시 수치 불안정

**주기적 진동**:
- Figure-8과 Chaotic에서 관측
- RK4의 고유한 특성 (symplectic 아님)
- 하지만 평균적으로 보존됨

### 운동량 보존 (Momentum Conservation)

**물리 법칙**:
```
P = Σ m_i v_i = 상수
```

**결과**:
| 시나리오 | 운동량 크기 | 평가 |
|---------|-------------|------|
| Figure-8 | ~10⁻¹⁵ | 수치 정밀도 한계 ✓ |
| Sun-Earth-Moon | ~10⁻⁵ | 태양 고정 가정 때문 |
| Chaotic | ~10⁻¹³ | 수치 정밀도 한계 ✓ |

**운동량 비보존 이유**:
- **Figure-8, Chaotic**: 부동소수점 연산 오차 (무시 가능)
- **Sun-Earth-Moon**: 태양을 원점에 고정 (실제로는 중심 질량계 이동)

---

## 수치 방법 (Numerical Methods)

### RK4 (Runge-Kutta 4th Order)

**알고리즘**:
```python
k1 = f(y, t)
k2 = f(y + 0.5*dt*k1, t + 0.5*dt)
k3 = f(y + 0.5*dt*k2, t + 0.5*dt)
k4 = f(y + dt*k3, t + dt)

y_next = y + (dt/6) * (k1 + 2*k2 + 2*k3 + k4)
```

**특징**:
- 4차 정확도: 오차 ∝ dt⁴
- 각 단계마다 4번 함수 평가
- 산업 표준

**시간 간격**:
- Figure-8: dt = 0.001
- Sun-Earth-Moon: dt = 0.0005
- Chaotic: dt = 0.005

### 충돌 방지 (Collision Avoidance)

```python
d12 = max(np.linalg.norm(r12), 1e-3)
```

물체가 너무 가까워지면 중력이 무한대로 발산하는 문제를 방지합니다.

---

## 물리적 통찰

### 1. 왜 대부분 혼돈적인가?

**위상 공간 (Phase Space)**:
- 3체: 18차원 (각 물체당 6차원: x, y, z, vx, vy, vz)
- 보존 법칙으로 10차원으로 축소
- 여전히 고차원 → 복잡한 동역학

**비선형성**:
```
F ∝ 1/r²  (비선형!)
```
- 선형 시스템: 예측 가능
- 비선형 시스템: 작은 섭동 → 큰 변화

### 2. Figure-8은 왜 안정한가?

**대칭성**:
- 세 물체가 동등한 역할
- 질량 중심이 고정
- 각운동량 0

**공명 (Resonance)**:
- 세 물체의 운동이 특별한 주파수 비
- 서로 간섭이 최소화
- 에너지 교환이 균형

### 3. 실제 응용

**천체역학**:
- 라그랑주 점 (L1~L5)
- James Webb 우주 망원경 (L2)
- 소행성 궤도 예측

**우주선 궤도 설계**:
- 중력 보조 (Gravity Assist)
- 최소 에너지 궤적
- 호만 전이 궤도

**은하 동역학**:
- 별의 운동
- 은하 충돌
- 암흑 물질 분포

---

## 재현 방법

### 요구사항
```bash
python >= 3.8
numpy
matplotlib
```

### 실행
```bash
cd week9/ex
python 01three_body.py
```

### 실행 시간
- Figure-8: ~10초
- Sun-Earth-Moon: ~15초
- Chaotic: ~20초
- 총: 약 1분

---

## 향상 방법

### 1. 더 정확한 적분

**Symplectic Integrator**:
- 에너지를 정확히 보존
- 예: Leapfrog, Verlet

**Adaptive Step Size**:
- 물체가 가까우면 dt 감소
- 멀면 dt 증가
- 계산 효율 향상

### 2. 3차원 확장

현재: 2D (x, y)
→ 3D (x, y, z) 확장 가능

### 3. 더 많은 물체

- 4체, 5체, ...
- N-body 시뮬레이션
- 은하 시뮬레이션

### 4. 상대론 효과

- 일반 상대성 이론
- 수성 근일점 이동
- 중력파

---

## 참고 문헌

1. **Figure-8 Orbit**:
   - C. Moore (1993), "Braids in classical dynamics"
   - A. Chenciner & R. Montgomery (2000), "A remarkable periodic solution of the three-body problem in the case of equal masses"

2. **혼돈 이론**:
   - H. Poincaré (1890), "Sur le problème des trois corps et les équations de la dynamique"
   - E. Lorenz (1963), "Deterministic nonperiodic flow"

3. **수치 방법**:
   - J.C. Butcher (1996), "A history of Runge-Kutta methods"
   - E. Hairer et al. (2006), "Geometric Numerical Integration"

4. **응용**:
   - V. Szebehely (1967), "Theory of Orbits"
   - C.D. Murray & S.F. Dermott (1999), "Solar System Dynamics"

---

## 결론

3체 문제는 단순해 보이지만 엄청나게 복잡합니다. 

**핵심 교훈**:
1. ✓ 단순한 법칙 → 복잡한 거동
2. ✓ 해석적 해 없음 → 수치 시뮬레이션 필수
3. ✓ 혼돈 = 예측 불가능 (but 결정론적)
4. ✓ 보존 법칙 = 수치 검증의 핵심
5. ✓ 특수 해 (Figure-8) = 자연의 놀라운 대칭성

**다음 단계**:
- 더 많은 물체 (N-body)
- 3차원 확장
- 상대론 효과
- 기계학습으로 혼돈 예측

---

생성 일시: 2025-11-21
프로그램: `01three_body.py`
작성자: Week 9 Classical Mechanics Simulations


