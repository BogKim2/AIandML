# Week 12: 통계물리 및 Monte Carlo 시뮬레이션

## 📚 학습 목표

이번 주차에서는 통계물리학의 핵심 개념들과 Monte Carlo 방법을 학습합니다.

**배울 내용:**
1. Monte Carlo 방법의 원리와 응용
2. 이징 모델과 상전이
3. Metropolis-Hastings 알고리즘
4. 열역학적 성질 계산
5. 분배 함수(Partition Function)
6. 클러스터 분석과 임계 현상

**왜 중요한가?**
- 통계물리학은 미시 세계와 거시 세계를 연결
- 상전이는 자연에서 가장 보편적인 현상
- Monte Carlo 방법은 다양한 분야에서 활용
- 강자성, 초전도, 상전이 등 실제 물리 현상 이해

---

## 🎯 들어가기: 통계물리학이란?

### 왜 통계물리학인가?

**미시적 법칙 (고전역학, 양자역학)**
- 개별 입자의 운동 방정식
- 정확하지만 계산 불가능 (N ~ 10²³)

**거시적 현상 (열역학)**
- 온도, 압력, 엔트로피
- 관측 가능하지만 미시적 기원은?

**통계물리학의 역할**
- 미시적 → 거시적 연결
- 앙상블 평균으로 열역학 도출
- 상전이, 임계 현상 설명

### Monte Carlo 방법이란?

**무작위 샘플링으로 문제 해결**
1. 랜덤하게 상태를 선택
2. 확률 분포에 따라 수락/거부
3. 많은 샘플로 평균 계산
4. 통계적으로 정확한 결과

**장점:**
- 고차원 문제에 효과적
- 해석적 해가 없어도 가능
- 복잡한 시스템에 적용 가능

**단점:**
- 통계적 오차 (~ 1/√N)
- 평형 도달 시간 필요
- 효율성이 중요

---

## 🔬 Lab 1: 랜덤 워크 (01_random_walk.py)

### 목적
Monte Carlo 방법의 가장 기본적인 예제인 랜덤 워크를 통해 확률 과정을 이해합니다.

### 프로그램 실행
```bash
cd week12
python 01_random_walk.py
```

### 물리적 배경

**랜덤 워크란?**
- 각 스텝에서 무작위 방향으로 이동
- 브라운 운동의 이산적 모델
- 확산 현상의 기초

**1D 랜덤 워크:**
```
위치: x(t+1) = x(t) + 스텝 (±1)
평균: <x> = 0
분산: <x²> = t
```

**2D 랜덤 워크:**
```
위치: (x, y)
각도: θ = random(0, 2π)
이동: dx = cos(θ), dy = sin(θ)
거리: <r²> = 2t
```

### 주요 결과

**중심극한정리 (Central Limit Theorem)**
- 많은 독립적인 랜덤 사건의 합
- → 가우시안 분포로 수렴
- 최종 위치가 정규분포를 따름

**평균 제곱 변위 (Mean Square Displacement)**
- MSD = <r²(t)>
- 1D: <x²> ~ t
- 2D: <r²> ~ 2t
- 3D: <r²> ~ 3t

**확산 상수 (Diffusion Constant)**
- MSD = 2dDt (d = 차원)
- 1D: <x²> = 2Dt → D = 0.5
- 확산 방정식과 연결

### 출력 파일
- `outputs/01_random_walk_1d.png`: 1D 워크 분석
- `outputs/01_random_walk_2d.png`: 2D 워크 분석

---

## 🔬 Lab 2: 원주율 추정 (02_pi_estimation.py)

### 목적
Monte Carlo 적분의 대표적인 예제로 π 값을 추정합니다.

### 물리적 배경

**Monte Carlo 적분 원리:**
1. 영역에 랜덤 점 뿌리기
2. 함수 아래 점의 비율 계산
3. 비율 × 영역 = 적분값

**π 추정 방법:**
```
단위 정사각형 [0,1] × [0,1]
1/4 원: x² + y² ≤ 1
원의 면적 = π/4
π ≈ 4 × (원 안의 점) / (전체 점)
```

### 주요 결과

**수렴 속도:**
- 오차 ~ 1/√N
- N배 증가 → 오차 √N배 감소
- 차원에 무관! (Monte Carlo의 장점)

**통계적 오차:**
- 평균: 실제 값으로 수렴
- 표준편차: 1/√N
- 더 많은 샘플 = 더 정확

### 적용 예시
- 고차원 적분
- 복잡한 형상의 면적/부피
- 물리학: 경로 적분, 상태 밀도

---

## 🔬 Lab 3: 1D 이징 모델 (03_ising_1d.py)

### 목적
이징 모델의 가장 간단한 형태인 1D 버전을 학습하여 2D로 확장하기 위한 준비를 합니다.

### 물리적 배경

**이징 모델이란?**
- 스핀: s_i = +1 (↑) 또는 -1 (↓)
- 이웃 간 상호작용
- 온도에 따른 정렬/무질서

**Hamiltonian:**
```
H = -J Σ s_i·s_{i+1}

J > 0: 강자성 (같은 방향 선호)
J < 0: 반강자성 (반대 방향 선호)
```

**물리량:**
```
자화(Magnetization): M = (1/N) Σ s_i
에너지: E = -J Σ s_i·s_{i+1}
```

### Metropolis 알고리즘

**기본 원리:**
1. 무작위로 스핀 선택
2. 뒤집었을 때 에너지 변화 계산: ΔE
3. 수락 기준:
   - ΔE < 0: 항상 수락
   - ΔE > 0: 확률 exp(-ΔE/T)로 수락

**왜 이렇게?**
- 볼츠만 분포 생성: P ~ exp(-E/T)
- 상세 균형 조건 만족
- 평형 상태로 수렴

### 주요 결과

**1D 이징 모델의 특징:**
- **상전이 없음!** (T > 0에서 M = 0)
- 정확해 존재:
  - E/N = -J tanh(J/T)
  - C/N = (J/T)² sech²(J/T)
- 상관 길이 유한

**왜 상전이가 없나?**
- 1D: 한 곳만 끊어져도 질서 파괴
- 엔트로피가 에너지 이김
- 열요동이 너무 강함

**2D와의 차이:**
- 2D는 상전이 있음!
- 차원이 중요: Mermin-Wagner 정리
- Tc(2D) ~ 2.269 J/kB

### 출력 파일
- `outputs/03_ising_1d_temperatures.png`
- `outputs/03_ising_1d_thermodynamics.png`
- `outputs/03_ising_1d_correlation.png`

---

## 🔬 Lab 4: Metropolis 알고리즘 (04_metropolis.py)

### 목적
Monte Carlo의 핵심인 Metropolis-Hastings 알고리즘을 상세히 이해합니다.

### 물리적 배경

**Detailed Balance (상세 균형):**
```
P(i→j) · P_eq(i) = P(j→i) · P_eq(j)

여기서:
P(i→j): i에서 j로 전이 확률
P_eq(i): 평형 상태에서 i의 확률
```

**볼츠만 분포:**
```
P_eq(i) ∝ exp(-E_i / kT)

낮은 에너지 = 높은 확률
높은 온도 = 더 균등한 분포
```

### Metropolis 수락 기준

**제안 확률:** g(i→j) = g(j→i) (대칭)

**수락 확률:**
```
A(i→j) = min[1, exp(-(E_j - E_i)/T)]

= 1           if ΔE < 0  (에너지 감소)
= exp(-ΔE/T)  if ΔE > 0  (에너지 증가)
```

**결과:** P(i→j) = g(i→j) · A(i→j)

### 주요 매개변수

**Step Size (이동 거리):**
- 너무 작음: 수락률 높지만 탐색 느림
- 너무 큼: 수락률 낮고 비효율적
- 최적: ~50% 수락률

**평형화 (Equilibration):**
- 초기 상태에서 평형까지 시간 필요
- "Burn-in" 기간: 버려야 할 초기 데이터
- 자기상관 시간의 10배 정도

### 검증

**Detailed Balance 확인:**
- 긴 시뮬레이션으로 분포 생성
- 볼츠만 분포와 비교
- 자유 에너지 계산

---

## 🔬 Lab 5: 2D 이징 모델 기초 (05_ising_2d_basic.py)

### 목적
드디어 상전이를 보여주는 2D 이징 모델을 시뮬레이션합니다.

### 물리적 배경

**2D 정사각 격자:**
```
각 스핀: 4개 이웃
주기적 경계 조건
격자 크기: L × L
```

**Hamiltonian:**
```
H = -J Σ_{<i,j>} s_i · s_j

<i,j>: 이웃 쌍
```

**임계 온도 (Onsager 정확해):**
```
k_B T_c / J = 2 / ln(1 + √2) ≈ 2.269
```

### 상전이 현상

**T < T_c: 질서 상 (Ordered Phase)**
- 높은 자화: |M| ~ 1
- 큰 도메인
- 낮은 에너지

**T = T_c: 임계점 (Critical Point)**
- 모든 크기의 클러스터
- 큰 요동
- 긴 상관 길이

**T > T_c: 무질서 상 (Disordered Phase)**
- 자화 ≈ 0
- 무작위 스핀
- 높은 에너지

### Monte Carlo Sweep

**정의:**
- N번의 스핀 플립 시도 (N = L²)
- 평균적으로 각 스핀 1번 시도
- 시간 단위로 사용

**구현:**
```python
for _ in range(N):
    i, j = random_site()
    ΔE = calculate_energy_change(i, j)
    if accept(ΔE, T):
        flip_spin(i, j)
```

### 주요 관찰

**자화의 온도 의존성:**
- T → 0: M → 1
- T → Tc: M 급격히 감소
- T > Tc: M ≈ 0

**에너지 변화:**
- 저온: E ≈ -2J (모두 정렬)
- 고온: E ≈ 0 (무작위)
- Tc 근처: 급격한 변화

---

## 🔬 Lab 6: 상전이 분석 (06_phase_transition.py)

### 목적
상전이를 정량적으로 분석하고 임계 지수를 추정합니다.

### 열역학적 반응 함수

**자화율 (Susceptibility):**
```
χ = N · (<M²> - <M>²) / T

= ∂M / ∂h (h=0)
```
- 자기장에 대한 감응도
- Tc에서 발산

**비열 (Specific Heat):**
```
C = N · (<E²> - <E>²) / T²

= ∂E / ∂T
```
- 온도 변화에 대한 에너지 변화
- Tc에서 발산 (2D Ising: logarithmic)

### 유한 크기 효과

**작은 시스템:**
- 전이가 둥글게 (rounded)
- 피크가 낮음
- Tc 추정이 어려움

**큰 시스템:**
- 날카로운 전이
- 높은 피크
- 진짜 Tc에 근접

**Finite Size Scaling:**
```
χ_max ~ L^(γ/ν)
C_max ~ L^(α/ν)

L → ∞: 열역학적 극한
```

### 임계 지수 (Critical Exponents)

**정의:**
```
M ~ (Tc - T)^β     (T < Tc)
χ ~ |T - Tc|^(-γ)
C ~ |T - Tc|^(-α)
ξ ~ |T - Tc|^(-ν)

ξ: 상관 길이
```

**2D Ising 이론값:**
```
β = 1/8 = 0.125
γ = 7/4 = 1.75
ν = 1
α = 0 (logarithmic)
```

**보편성 (Universality):**
- 같은 차원, 같은 대칭성
- → 같은 임계 지수
- 미시적 세부 사항 무관!

### 출력 해석

**χ vs T 그래프:**
- 피크 위치 ≈ Tc
- 피크 높이 ~ L^1.75

**C vs T 그래프:**
- 피크 위치 ≈ Tc
- 2D Ising: 로그 발산

---

## 🔬 Lab 7: 열역학 (07_thermodynamics.py)

### 목적
완전한 열역학적 성질과 분배 함수를 계산합니다.

### 열역학 포텐셜

**내부 에너지 (Internal Energy):**
```
E = <H> = Σ E_i P(E_i)
```

**엔트로피 (Entropy):**
```
S = -k_B Σ P_i ln(P_i)

또는: dS = dE/T (일정 부피)
```

**자유 에너지 (Helmholtz Free Energy):**
```
F = E - TS

= -k_B T ln(Z)
```

**관계식:**
```
E = -∂(ln Z)/∂β    (β = 1/T)
S = -∂F/∂T
P = -∂F/∂V
```

### 분배 함수 (Partition Function)

**정의:**
```
Z = Σ_states exp(-E_state / T)
```

**의미:**
- 모든 상태의 "가중치" 합
- 열역학의 generating function
- 모든 열역학 량 계산 가능

**문제점:**
- 상태 수가 너무 많음 (2^N)
- 직접 계산 불가능

**히스토그램 방법:**
1. 참조 온도에서 시뮬레이션
2. 에너지 분포 h(E) 측정
3. 상태 밀도 추정: g(E) ~ h(E) · exp(E/T_ref)
4. 다른 온도: Z(T) = Σ g(E) exp(-E/T)

### 에너지 분포

**저온:**
- 좁은 분포
- 낮은 에너지에 집중
- 작은 요동

**고온:**
- 넓은 분포
- 높은 에너지
- 큰 요동

**임계점:**
- 매우 넓은 분포
- 모든 에너지 상태 혼재
- 최대 요동

---

## 🔬 Lab 8: 고급 분석 (08_ising_2d_advanced.py)

### 목적
대규모 시스템의 고급 분석: 애니메이션, 클러스터, 히스테리시스, 자기상관.

**실행 시간: 5-10분**

### 열평형 과정 애니메이션

**관찰:**
- 초기 무작위 상태
- 도메인 형성
- 경계 이동
- 최종 평형

**임계점에서:**
- 계속 변하는 클러스터
- 모든 길이 척도 존재
- "임계 유동성 (critical opalescence)"

### 클러스터 분석

**클러스터 정의:**
- 같은 스핀의 연결된 영역
- 4-connectivity (상하좌우)

**클러스터 크기 분포:**
```
n(s): 크기 s인 클러스터 개수

T < Tc: 한 개 거대 클러스터
T = Tc: n(s) ~ s^(-τ), τ ≈ 2.05
T > Tc: 많은 작은 클러스터
```

**물리적 의미:**
- 상관된 영역의 크기
- 상전이의 "조짐"
- 임계점: 척도 불변성 (scale invariance)

### 상관 길이 (Correlation Length)

**정의:**
```
C(r) = <s(0) · s(r)> - <s(0)>·<s(r)>

     ~ exp(-r/ξ)

ξ: 상관 길이
```

**온도 의존성:**
```
ξ ~ |T - Tc|^(-ν)

T → Tc: ξ → ∞
```

**의미:**
- 스핀이 상관되는 거리
- 임계점에서 발산
- 클러스터의 특징 크기

### 히스테리시스 루프

**외부 자기장 h:**
```
H = -J Σ s_i·s_j - h Σ s_i
```

**히스테리시스:**
1. h 증가: M 증가
2. h = 0에서 M ≠ 0 (잔류 자화)
3. h 감소: M 다른 경로
4. 루프 형성

**특징:**
```
보자력 (Coercive field): M=0일 때 h
잔류 자화 (Remanence): h=0일 때 M
```

**물리적 의미:**
- 메모리 효과
- 자구벽 이동
- 자성 재료의 기본 특성

### 자기상관 시간

**정의:**
```
C_M(t) = <M(0)·M(t)> - <M>²

      ~ exp(-t/τ)

τ: 자기상관 시간
```

**의미:**
- 시스템이 "기억"을 잃는 시간
- 독립 샘플 간격
- MC 효율성

**임계 느려짐 (Critical Slowing Down):**
```
T → Tc: τ → ∞

τ ~ ξ^z, z ≈ 2 (동역학 지수)
```

---

## 📊 주요 결과 요약

### Monte Carlo 방법

**장점:**
1. 고차원에 강함
2. 해석해 불필요
3. 유연한 적용

**단점:**
1. 통계적 오차 ~ 1/√N
2. 평형화 시간
3. 임계점 근처 느림

### 2D 이징 모델

**상전이:**
```
Tc ≈ 2.269 J/kB

T < Tc: 자발적 자화
T = Tc: 임계 요동
T > Tc: 상자성
```

**임계 지수:**
```
β = 0.125
γ = 1.75
ν = 1.0
```

**보편성:**
- 2D, Z₂ 대칭성
- 같은 임계 지수
- Onsager 정확해

### 물리적 통찰

**상전이의 본질:**
- 대칭성 파괴
- 긴 거리 질서
- 집단 현상

**임계 현상:**
- 척도 불변성
- 요동 지배
- 보편적 거동

**통계물리의 힘:**
- 미시 → 거시
- 많은 입자 → 새로운 성질
- 창발적 현상

---

## 💡 실전 팁

### 프로그램 실행 순서

1. **01-02**: Monte Carlo 기초 (~각 1분)
2. **03-04**: 이징 모델 준비 (~각 1-2분)
3. **05**: 2D 이징 기초 (~2분)
4. **06**: 상전이 분석 (~3분)
5. **07**: 열역학 (~3분)
6. **08**: 고급 분석 (~7분)

### 매개변수 조정

**격자 크기 L:**
- 작게 (20): 빠르지만 유한 크기 효과
- 크게 (100): 정확하지만 느림
- 권장: 40-60

**온도 범위:**
- Tc 근처 조밀하게
- 1.5 ~ 3.5 정도

**MC sweeps:**
- 평형화: 200-500
- 측정: 1000-3000
- 정확도 vs 시간 trade-off

### 결과 검증

**확인 사항:**
1. Tc ≈ 2.269?
2. 임계 지수 맞나?
3. 에너지 보존?
4. 자기상관 시간 합리적?

**문제 징후:**
- M > 1 또는 < -1
- 에너지가 계속 변함
- 수렴하지 않음

---

## 📖 더 공부하려면

### 추천 교재

1. **Statistical Mechanics** - R. K. Pathria
   - 통계역학 전반
   - 앙상블 이론
   - 상전이

2. **Introduction to Monte Carlo Methods** - Landau & Binder
   - Monte Carlo 기법 상세
   - 통계물리 응용
   - 실용적 알고리즘

3. **Computational Physics** - Newman
   - Python 구현
   - 수치 방법
   - 실제 문제

### 관련 주제

**더 깊이:**
- Cluster 알고리즘 (Wolff, Swendsen-Wang)
- 다른 모델 (Potts, XY, Heisenberg)
- Renormalization Group
- Quantum Monte Carlo

**응용 분야:**
- 자성 재료
- 합금 (order-disorder)
- 생물물리 (단백질 접힘)
- 경제물리 (Econophysics)

### 온라인 자료

- **Wikipedia**: Ising Model, Phase Transition
- **Coursera**: Statistical Mechanics
- **arXiv**: cond-mat (응집물질물리)

---

## 🔧 문제 해결

### 자주 하는 실수

**1. 평형화 부족**
```
증상: 초기 상태에 의존
해결: n_equilibration 증가
```

**2. 샘플 수 부족**
```
증상: 큰 오차, 불안정
해결: n_sweeps 증가
```

**3. 유한 크기 효과**
```
증상: 둥근 전이
해결: L 증가, 여러 L 비교
```

**4. 스텝 크기 부적절**
```
증상: 수락률 너무 높거나 낮음
해결: step_size 조정
```

### 성능 최적화

**빠른 실행:**
- L 작게 (20-40)
- sweeps 줄이기
- 온도 점 줄이기

**정확한 결과:**
- L 크게 (60-100)
- sweeps 늘리기
- Tc 근처 조밀

---

## 🎓 학습 점검

### 이해했는지 확인

**기본:**
- [ ] Monte Carlo 방법의 원리?
- [ ] Metropolis 알고리즘?
- [ ] 볼츠만 분포?
- [ ] 상전이란?

**중급:**
- [ ] Detailed balance?
- [ ] 자화율, 비열 계산?
- [ ] 임계 지수의 의미?
- [ ] 유한 크기 스케일링?

**고급:**
- [ ] 분배 함수 추정?
- [ ] 클러스터 분석?
- [ ] 상관 길이?
- [ ] 자기상관 시간?

### 실습 과제

1. **온도 스캔**: Tc를 정확히 찾아보기
2. **크기 효과**: 여러 L로 비교
3. **임계 지수**: β, γ 측정
4. **히스테리시스**: 보자력 측정
5. **최적화**: 가장 효율적인 매개변수?

---

## ✨ 결론

**배운 것:**
- Monte Carlo는 강력한 도구
- 통계물리는 미시↔거시 연결
- 상전이는 보편적 현상
- 수치 시뮬레이션으로 이해 가능

**중요한 교훈:**
- 많은 입자 → 새로운 현상
- 대칭성과 요동의 경쟁
- 차원이 중요
- 보편성과 척도 불변성

**다음 단계:**
- 다른 모델 (XY, Heisenberg)
- 양자 시스템
- 실제 재료 모델링
- 머신러닝과 결합

---

*"More is different." - P. W. Anderson*

통계물리학은 단순한 규칙에서 복잡한 현상이 어떻게 나타나는지 보여줍니다!

